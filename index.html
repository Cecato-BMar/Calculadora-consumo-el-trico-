import React, { useState } from 'react';
import { Trash2, Zap, Calculator, Plus, Edit3 } from 'lucide-react';

const ElectricityCalculator = () => {
  const [appliances, setAppliances] = useState([]);
  const [electricityRate, setElectricityRate] = useState(0.75); // R$/kWh
  const [showForm, setShowForm] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [formData, setFormData] = useState({
    name: '',
    power: '',
    hoursPerDay: '',
    daysPerMonth: ''
  });

  const commonAppliances = [
    { name: 'Geladeira', power: 350 },
    { name: 'Ar Condicionado', power: 1500 },
    { name: 'Chuveiro Elétrico', power: 5500 },
    { name: 'Micro-ondas', power: 1200 },
    { name: 'Televisão LED 40"', power: 150 },
    { name: 'Máquina de Lavar', power: 500 },
    { name: 'Ferro de Passar', power: 1000 },
    { name: 'Ventilador', power: 120 },
    { name: 'Computador', power: 300 },
    { name: 'Lâmpada LED', power: 10 }
  ];

  const handleSubmit = () => {
    
    if (!formData.name || !formData.power || !formData.hoursPerDay || !formData.daysPerMonth) {
      alert('Por favor, preencha todos os campos');
      return;
    }

    const newAppliance = {
      id: editingId || Date.now(),
      name: formData.name,
      power: parseFloat(formData.power),
      hoursPerDay: parseFloat(formData.hoursPerDay),
      daysPerMonth: parseFloat(formData.daysPerMonth)
    };

    if (editingId) {
      setAppliances(prev => prev.map(app => app.id === editingId ? newAppliance : app));
    } else {
      setAppliances(prev => [...prev, newAppliance]);
    }

    resetForm();
  };

  const resetForm = () => {
    setFormData({ name: '', power: '', hoursPerDay: '', daysPerMonth: '' });
    setShowForm(false);
    setEditingId(null);
  };

  const editAppliance = (appliance) => {
    setFormData({
      name: appliance.name,
      power: appliance.power.toString(),
      hoursPerDay: appliance.hoursPerDay.toString(),
      daysPerMonth: appliance.daysPerMonth.toString()
    });
    setEditingId(appliance.id);
    setShowForm(true);
  };

  const deleteAppliance = (id) => {
    setAppliances(prev => prev.filter(app => app.id !== id));
  };

  const calculateConsumption = (appliance) => {
    // Consumo em kWh por mês
    return (appliance.power * appliance.hoursPerDay * appliance.daysPerMonth) / 1000;
  };

  const calculateCost = (appliance) => {
    return calculateConsumption(appliance) * electricityRate;
  };

  const totalConsumption = appliances.reduce((sum, app) => sum + calculateConsumption(app), 0);
  const totalCost = appliances.reduce((sum, app) => sum + calculateCost(app), 0);

  const selectCommonAppliance = (common) => {
    setFormData(prev => ({
      ...prev,
      name: common.name,
      power: common.power.toString()
    }));
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-6xl mx-auto">
        <header className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Zap className="w-8 h-8 text-blue-600" />
            <h1 className="text-3xl font-bold text-gray-800">
              Calculadora de Consumo Elétrico
            </h1>
          </div>
          <p className="text-gray-600">
            Calcule o consumo e gasto dos seus eletrodomésticos
          </p>
        </header>

        <div className="grid lg:grid-cols-2 gap-8">
          {/* Formulário */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-semibold text-gray-800">
                {editingId ? 'Editar Aparelho' : 'Adicionar Aparelho'}
              </h2>
              {!showForm && (
                <button
                  onClick={() => setShowForm(true)}
                  className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                >
                  <Plus className="w-4 h-4" />
                  Adicionar
                </button>
              )}
            </div>

            {/* Tarifa de energia */}
            <div className="mb-6 p-4 bg-yellow-50 rounded-lg">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Tarifa de Energia Elétrica (R$/kWh)
              </label>
              <input
                type="number"
                step="0.01"
                value={electricityRate}
                onChange={(e) => setElectricityRate(parseFloat(e.target.value) || 0)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            {showForm && (
              <div className="space-y-4">
                {/* Aparelhos comuns */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Aparelhos Comuns (clique para usar)
                  </label>
                  <div className="grid grid-cols-2 gap-2 mb-4">
                    {commonAppliances.slice(0, 6).map((common, idx) => (
                      <button
                        key={idx}
                        type="button"
                        onClick={() => selectCommonAppliance(common)}
                        className="text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded transition-colors text-left"
                      >
                        {common.name} ({common.power}W)
                      </button>
                    ))}
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Nome do Aparelho
                  </label>
                  <input
                    type="text"
                    value={formData.name}
                    onChange={(e) => setFormData(prev => ({...prev, name: e.target.value}))}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Ex: Geladeira"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Potência (Watts)
                  </label>
                  <input
                    type="number"
                    value={formData.power}
                    onChange={(e) => setFormData(prev => ({...prev, power: e.target.value}))}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Ex: 350"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Horas por Dia
                  </label>
                  <input
                    type="number"
                    step="0.1"
                    value={formData.hoursPerDay}
                    onChange={(e) => setFormData(prev => ({...prev, hoursPerDay: e.target.value}))}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Ex: 8"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Dias por Mês
                  </label>
                  <input
                    type="number"
                    value={formData.daysPerMonth}
                    onChange={(e) => setFormData(prev => ({...prev, daysPerMonth: e.target.value}))}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Ex: 30"
                    required
                  />
                </div>

                <div className="flex gap-3">
                  <button
                    type="button"
                    onClick={handleSubmit}
                    className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition-colors"
                  >
                    {editingId ? 'Atualizar' : 'Adicionar'}
                  </button>
                  <button
                    type="button"
                    onClick={resetForm}
                    className="px-6 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors"
                  >
                    Cancelar
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* Lista de aparelhos e cálculos */}
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
              <Calculator className="w-5 h-5" />
              Seus Aparelhos
            </h2>

            {appliances.length === 0 ? (
              <div className="text-center py-12 text-gray-500">
                <Zap className="w-16 h-16 mx-auto mb-4 opacity-50" />
                <p>Nenhum aparelho adicionado ainda</p>
                <p className="text-sm">Clique em "Adicionar" para começar</p>
              </div>
            ) : (
              <>
                <div className="space-y-4 mb-6 max-h-96 overflow-y-auto">
                  {appliances.map((appliance) => (
                    <div key={appliance.id} className="border rounded-lg p-4 hover:bg-gray-50">
                      <div className="flex justify-between items-start mb-2">
                        <h3 className="font-semibold text-gray-800">{appliance.name}</h3>
                        <div className="flex gap-2">
                          <button
                            onClick={() => editAppliance(appliance)}
                            className="text-blue-600 hover:text-blue-800 p-1"
                          >
                            <Edit3 className="w-4 h-4" />
                          </button>
                          <button
                            onClick={() => deleteAppliance(appliance.id)}
                            className="text-red-600 hover:text-red-800 p-1"
                          >
                            <Trash2 className="w-4 h-4" />
                          </button>
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                        <div>Potência: {appliance.power}W</div>
                        <div>Uso: {appliance.hoursPerDay}h/dia</div>
                        <div>Frequência: {appliance.daysPerMonth} dias/mês</div>
                      </div>
                      <div className="grid grid-cols-2 gap-4 pt-3 border-t">
                        <div>
                          <span className="text-xs text-gray-500">Consumo mensal</span>
                          <div className="font-semibold text-blue-600">
                            {calculateConsumption(appliance).toFixed(2)} kWh
                          </div>
                        </div>
                        <div>
                          <span className="text-xs text-gray-500">Custo mensal</span>
                          <div className="font-semibold text-green-600">
                            R$ {calculateCost(appliance).toFixed(2)}
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                {/* Totais */}
                <div className="border-t pt-6">
                  <h3 className="font-semibold text-gray-800 mb-4">Resumo Mensal</h3>
                  <div className="grid grid-cols-2 gap-6">
                    <div className="text-center p-4 bg-blue-50 rounded-lg">
                      <div className="text-2xl font-bold text-blue-600">
                        {totalConsumption.toFixed(2)}
                      </div>
                      <div className="text-sm text-gray-600">kWh Total</div>
                    </div>
                    <div className="text-center p-4 bg-green-50 rounded-lg">
                      <div className="text-2xl font-bold text-green-600">
                        R$ {totalCost.toFixed(2)}
                      </div>
                      <div className="text-sm text-gray-600">Custo Total</div>
                    </div>
                  </div>
                  <div className="mt-4 text-center p-3 bg-yellow-50 rounded-lg">
                    <div className="text-lg font-semibold text-yellow-700">
                      Custo Anual Estimado: R$ {(totalCost * 12).toFixed(2)}
                    </div>
                  </div>
                </div>
              </>
            )}
          </div>
        </div>

        {/* Como Usar */}
        <div className="mt-8 bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-lg font-semibold text-gray-800 mb-4">📋 Como Usar</h3>
          <div className="space-y-4">
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center font-bold flex-shrink-0 mt-0.5">
                1
              </div>
              <div>
                <strong className="text-gray-800">Configure a tarifa de energia:</strong>
                <span className="text-gray-600"> Ajuste o valor em R$/kWh conforme sua conta de luz (geralmente entre R$ 0,60 e R$ 1,00).</span>
              </div>
            </div>
            
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center font-bold flex-shrink-0 mt-0.5">
                2
              </div>
              <div>
                <strong className="text-gray-800">Adicione seus aparelhos:</strong>
                <span className="text-gray-600"> Use os botões de aparelhos comuns ou crie personalizados clicando em "Adicionar".</span>
              </div>
            </div>
            
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center font-bold flex-shrink-0 mt-0.5">
                3
              </div>
              <div>
                <strong className="text-gray-800">Preencha as informações:</strong>
                <span className="text-gray-600"> Nome, potência (watts), horas por dia de uso e quantos dias por mês o aparelho funciona.</span>
              </div>
            </div>
            
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center font-bold flex-shrink-0 mt-0.5">
                4
              </div>
              <div>
                <strong className="text-gray-800">Visualize os resultados:</strong>
                <span className="text-gray-600"> Veja automaticamente o consumo em kWh e o custo mensal de cada aparelho.</span>
              </div>
            </div>
            
            <div className="flex items-start gap-3">
              <div className="w-6 h-6 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center font-bold flex-shrink-0 mt-0.5">
                5
              </div>
              <div>
                <strong className="text-gray-800">Gerencie sua lista:</strong>
                <span className="text-gray-600"> Edite ou exclua aparelhos usando os ícones ao lado direito de cada item.</span>
              </div>
            </div>
          </div>
          
          <div className="mt-6 p-4 bg-blue-50 rounded-lg">
            <h4 className="font-semibold text-blue-800 mb-2">🔍 Onde encontrar a potência do aparelho?</h4>
            <p className="text-sm text-blue-700">
              Procure por uma etiqueta ou placa no aparelho com informações técnicas. A potência geralmente está indicada em "W" (watts) ou "kW" (quilowatts). Se estiver em kW, multiplique por 1000 para converter para watts.
            </p>
          </div>
        </div>

        {/* Dicas */}
        <div className="mt-8 bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-lg font-semibold text-gray-800 mb-4">💡 Dicas para Economizar</h3>
          <div className="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
            <div>
              <strong>Chuveiro Elétrico:</strong> Reduza o tempo de banho e use na posição "verão" quando possível.
            </div>
            <div>
              <strong>Ar Condicionado:</strong> Mantenha entre 22-24°C e limpe os filtros regularmente.
            </div>
            <div>
              <strong>Geladeira:</strong> Não abra desnecessariamente e mantenha a temperatura adequada.
            </div>
            <div>
              <strong>Iluminação:</strong> Troque por lâmpadas LED e aproveite a luz natural.
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ElectricityCalculator;
